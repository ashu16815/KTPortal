{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nconst PUBLIC_PATHS = ['/login', '/_next', '/api/auth', '/favicon.ico']\nconst COOKIE_NAME = 'kt_stub_session'\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n\n  // Allow public paths\n  if (PUBLIC_PATHS.some(p => pathname.startsWith(p))) {\n    return NextResponse.next()\n  }\n\n  // Allow static files\n  if (pathname.match(/\\.(ico|png|jpg|svg|css|js)$/)) {\n    return NextResponse.next()\n  }\n\n  const sessionCookie = request.cookies.get(COOKIE_NAME)\n\n  if (!sessionCookie?.value) {\n    // API routes return 401\n    if (pathname.startsWith('/api/')) {\n      return NextResponse.json({ error: { code: 'UNAUTHENTICATED', message: 'Authentication required' } }, { status: 401 })\n    }\n    // UI routes redirect to login\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n\n  // Role-based guards for admin routes\n  if (pathname.startsWith('/admin') || pathname.startsWith('/api/admin')) {\n    try {\n      const session = JSON.parse(Buffer.from(sessionCookie.value, 'base64').toString('utf-8'))\n      if (session.role !== 'ADMIN') {\n        if (pathname.startsWith('/api/')) {\n          return NextResponse.json({ error: { code: 'FORBIDDEN', message: 'Admin access required' } }, { status: 403 })\n        }\n        return NextResponse.redirect(new URL('/dashboard/executive', request.url))\n      }\n    } catch {\n      return NextResponse.redirect(new URL('/login', request.url))\n    }\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: ['/((?!_next/static|_next/image|favicon.ico).*)'],\n}\n"],"names":[],"mappings":";;;;;;AAgCiC;AAhCjC;AAAA;;AAEA,MAAM,eAAe;IAAC;IAAU;IAAU;IAAa;CAAe;AACtE,MAAM,cAAc;AAEb,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,qBAAqB;IACrB,IAAI,aAAa,IAAI,CAAC,CAAA,IAAK,SAAS,UAAU,CAAC,KAAK;QAClD,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,qBAAqB;IACrB,IAAI,SAAS,KAAK,CAAC,gCAAgC;QACjD,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAE1C,IAAI,CAAC,eAAe,OAAO;QACzB,wBAAwB;QACxB,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;oBAAE,MAAM;oBAAmB,SAAS;gBAA0B;YAAE,GAAG;gBAAE,QAAQ;YAAI;QACrH;QACA,8BAA8B;QAC9B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,qCAAqC;IACrC,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,UAAU,CAAC,eAAe;QACtE,IAAI;YACF,MAAM,UAAU,KAAK,KAAK,CAAC,+HAAM,CAAC,IAAI,CAAC,cAAc,KAAK,EAAE,UAAU,QAAQ,CAAC;YAC/E,IAAI,QAAQ,IAAI,KAAK,SAAS;gBAC5B,IAAI,SAAS,UAAU,CAAC,UAAU;oBAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;4BAAE,MAAM;4BAAa,SAAS;wBAAwB;oBAAE,GAAG;wBAAE,QAAQ;oBAAI;gBAC7G;gBACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,QAAQ,GAAG;YAC1E;QACF,EAAE,OAAM;YACN,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAgD;AAC5D"}}]
}